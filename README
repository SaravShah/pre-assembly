==Pre-assembly

This is a Ruby implementation of services needed to prepare objects to be
assembled and then accessioned in SULAIR digital library.


==Running

1. Create project-configuration YAML file.
   See config/projects/TEMPLATE.yaml for a documented example.

2. Run pre-assembly locally:

    # Normal run.
    bin/pre-assemble YAML_FILE

    # Run in resume mode.
    bin/pre-assemble YAML_FILE --resume

3. Running in the production environment:

    - Navigate to the production box, in the pre-assembly area.
    - Set the ROBOT_ENVIRONMENT.
    - Run pre-assembly with nohup and in the background (&).
    - Optionally, include the --resume option.

    ssh lyberadmin@sul-lyberservices-prod.stanford.edu
    cd /home/lyberadmin/pre-assembly/current
    ROBOT_ENVIRONMENT=production nohup bin/pre-assemble YAML_FILE &

    # Various ways to monitor progress:
    The workflow grid in Argo.
    grep pid PROGRESS_LOG          # As defined in YAML progress_log_file.
    tail -999f log/production.log  # Detailed logging info.
    tail -999f nohup.out           # Errors, etc.


==Deployment

See Capfile.


==Setting up project for local development:

    # Clone project.
    git clone `whoami`@corn.stanford.edu:/afs/ir/dev/dlss/git/lyberteam/pre-assembly.git
    cd pre-assembly

    # Set up some stuff not stored in Git.
    mkdir doc log pkg tmp
    RCONF='lyberadmin@lyberservices-dev.stanford.edu:/home/lyberadmin/pre-assembly/config'
    scp -r $RCONF/certs $RCONF/environments config

    # Get needed gems.
    bundle install

    # Confirm that it's working.
    bin/run_all_tests 


==Running tests

For local testing, it's easiest to put this in your bash profile:

	export ROBOT_ENVIRONMENT=local

Running tests:

    # All tests.
    bin/run_all_tests

    # Unit tests and integration tests separately.
    bundle exec rspec spec
    bundle exec rspec integration
