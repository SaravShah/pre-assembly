<mods xmlns:mods="http://www.loc.gov/mods/v3" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="3.3" xsi:schemaLocation="http://www.loc.gov/mods/v3 http://www.loc.gov/standards/mods/v3/mods-3-3.xsd">
  <titleInfo>
    <title>[[title2]]</title>
  </titleInfo>
  <titleInfo type="alternative">
    <title>[[title1]]</title>
  </titleInfo>

<%
    def not_empty(key)
      v = manifest_row[key]
      v && ! v.strip.empty?
    end

    def get_value(key)
      if manifest_row[key]
        manifest_row[key].strip
      end
    end

    def build_key(name_prefix, key_part)
      "#{name_prefix}_#{key_part}".to_sym
    end


     key_names = %w(name1 name2 name3 name4 name5 name6) 
     key_names.each do |kn| 
      type_key = build_key(kn, 'type') 
      if not_empty(type_key) 
       name_key = build_key(kn, 'name') 
       when_key = build_key(kn, 'when') 
         where_key = build_key(kn, 'where') 
         role_key = build_key(kn, 'role') 
         role1_key = build_key(kn, 'role1') 
         role2_key = build_key(kn, 'role2') 
         node_value="<name type=\"#{get_value(type_key)}\"><namePart>#{get_value(name_key)}</namePart>" 
         node_value+="<namePart type=\"date\">#{get_value(when_key)}</namePart>" if not_empty(when_key) 
       node_value+="<description>#{get_value(where_key)}</description>" if not_empty(where_key) 
       if kn=='name4'
        node_value+="<role><roleTerm type=\"text\">#{get_value(role1_key)}</roleTerm></role>" if not_empty(role1_key) 
        node_value+="<role><roleTerm type=\"text\">#{get_value(role2_key)}</roleTerm></role>" if not_empty(role2_key) 
       else 
        node_value+="<role><roleTerm type=\"text\">#{get_value(role_key)}</roleTerm></role>" if not_empty(role_key) 
       end 
      node_value+="</name>" 
%>

    <%= node_value %>
 <% end %>
<% end%>

  <% if not_empty(:provenance) %>
    <%= "<name type=\"corporate\"><namePart>#{get_value(:provenance)}</namePart><role><roleTerm type=\"text\">provenance</roleTerm></role></name>"%>
  <% end %>

    <typeOfResource>still image</typeOfResource>
  <% if not_empty(:pubdate) %>
    <%= "<originInfo><dateIssued>#{get_value(:pubdate)}</dateIssued></originInfo>" %>
  <% end %>

  <% if !['Paintings','Drawings','Graphics'].include? get_value(:type) %>
      <%= "<subject><topic authority=\"lcsh\">#{get_value(:type)}</topic></subject>" %>
  <% end %>

  <physicalDescription>
  <% if ['Paintings','Drawings','Graphics'].include? get_value(:type) %>
      <%= "<form authority=\"aat\">#{get_value(:type)}</form>" %>
  <% end %>
    <form>[[medium]]</form>
    <note displayLabel="Dimensions">[[dimensions]]</note>
    <note displayLabel="Condition">[[condition]]</note>
  </physicalDescription>
  <% if not_empty(:note) %><%= "<note>#{get_value(:note)}</note>" %> <% end %>
  <% if not_empty(:description)  %><%= "<note>#{get_value(:description)}</note>" %> <% end %>
  <identifier type="local">[[id]]</identifier>
</mods>
